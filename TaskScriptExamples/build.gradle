/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

//defaultTasks(["hello1", "hi", "hello2"])
defaultTasks("doFinished")
logger.info(">>> build.gradle ---> This is execute during the configuratoin phase - timestamp @ ${gradle.timestamp()}")

task hi

project.hi.doLast {
	logger.info("HI =============> ")
}

task hello1 {
	description = "Log the name of the Task"
	group = "Welcome"
	doFirst {
		println("My name is: $name and this is my 1st defined action")
	}
	doLast {
		println("My name is: $name and this is my 2nd defined action")
	}
}

hello1.doLast {
	println("My name is: $name and this is my 3rd defined action")
}

logger.info(hello1.description)
logger.info(hello1.group)

task hello2 {
	description = "Log the name of the Task"
	group = "Welcome"
}

hello2
		.doFirst {
			println("My name is: $name and this is my 1st defined Action")
		}
		.doLast {
			println("My name is: $name and this is my 2nd defined Action")
		}

task doStartProcess {
	doLast {
		logger.info("$name - Now starting the process - OK!")
	}
}

task doStep2 (dependsOn: "doStartProcess") {
	doLast {
		logger.info("$name - Performed - OK!")
	}
}

task doSomethingInTheMiddle (dependsOn: ["doStartProcess", tasks.findAll {
	task -> task.name.startsWith("doStep2")
}]) {
	doLast {
		logger.info("$name - Performed the middle step - OK!")
	}
}

task doFinished {
	doLast {
		logger.info("$name - Done - OK! >>> with version=$version")
	}
}

doFinished.dependsOn doSomethingInTheMiddle, doStep2

logger.info(""">>> ${project.tasks.findAll {
	task -> task.name.startsWith('doStep2')
}}
""")

project.gradle.taskGraph.whenReady { taskGraph ->
	if(taskGraph.hasTask(doStep2)) {
		project.version = "1.0"
	} else {
		project.version = "1.0-SNAPSHOT"
	}
	logger.info "WhenReady >>> $project.gradle.taskGraph.allTasks"
}